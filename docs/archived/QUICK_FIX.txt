================================================================================
CoreDNA2 - "Add an API Key" Error Quick Fix
================================================================================

SYMPTOM:
  App says "Go to Settings → API Keys to add an LLM provider and its API key"
  Even though you already added one

ROOT CAUSES:
  1. Key not saved to browser storage (auto-save not triggered)
  2. Key is empty string (spaces only)
  3. Provider name mismatch
  4. Browser cache issue

================================================================================
QUICK FIXES (Try in order)
================================================================================

FIX #1: Wait & Save (60 seconds)
  1. Open Settings → LLM tab
  2. Make sure provider is ENABLED (toggle is GREEN)
  3. Paste API key in the field
  4. WAIT 3+ seconds (auto-save takes 2 seconds)
  5. Should see success message
  6. Go to Extract page
  7. Try again

FIX #2: Manual Save
  1. Open Settings → LLM tab
  2. Add/paste API key in field
  3. Scroll to bottom
  4. Click "Save Settings" button
  5. Wait for confirmation message
  6. Try extraction again

FIX #3: Check Console
  1. Press F12 to open console
  2. Copy-paste this command:
     JSON.parse(localStorage.getItem('core_dna_settings')||'{}').llms
  3. Look for your provider (e.g., "google")
  4. Check if apiKey field has actual text (not empty)
  5. If empty, repeat FIX #1 or #2

FIX #4: Hard Refresh (Clear Cache)
  1. Press Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)
  2. Wait for page to reload
  3. Go to Settings
  4. Add provider and API key again
  5. Click Save
  6. Try extraction

FIX #5: Nuclear Reset
  1. Open console (F12)
  2. Paste: localStorage.removeItem('core_dna_settings');location.reload();
  3. Wait for reload
  4. Go to Settings and setup providers fresh
  5. Add API key
  6. Click Save
  7. Try extraction

================================================================================
STEP-BY-STEP IF NONE ABOVE WORK
================================================================================

1. Open Browser Console (F12 → Console tab)

2. Check current settings:
   JSON.parse(localStorage.getItem('core_dna_settings')||'{}')

3. What to look for in settings:
   {
     "llms": {
       "google": {
         "provider": "google",
         "enabled": true,
         "apiKey": "YOUR_ACTUAL_KEY_HERE"  ← Should NOT be empty
       }
     },
     "activeLLM": "google"  ← Should match your chosen provider
   }

4. If apiKey is empty string:
   - Go back to Settings
   - Paste your API key again
   - Wait 3 seconds
   - OR click Save button
   - Check console again

5. If activeLLM is not set:
   - Go to Settings → LLM tab
   - Select a provider in "Primary LLM Engine" dropdown
   - Wait for auto-save (2 sec)
   - Check console again

6. If still failing:
   - Report the console output above

================================================================================
WHAT IS SUPPOSED TO HAPPEN
================================================================================

Timeline:
  1. You open Settings page
  2. You select provider (e.g., "Google Gemini")
  3. Provider card appears with toggle OFF
  4. You click toggle to turn ON (Green)
  5. Card expands showing API Key field
  6. You paste your API key
  7. After 2 seconds, auto-save triggers
  8. localStorage gets updated
  9. Browser console shows [SettingsPage] Settings auto-saved successfully
  10. You go to Extract page
  11. Extract page calls getActiveLLMProvider()
  12. Function finds your API key in localStorage
  13. Extraction starts

If Step 9 doesn't happen = problem
If Step 12 fails = settings not saved correctly

================================================================================
VERIFY IT'S FIXED
================================================================================

Before trying extraction, verify in console:

const s=JSON.parse(localStorage.getItem('core_dna_settings')||'{}');
if (s.llms?.google?.apiKey && s.activeLLM === 'google') {
  console.log('✓ READY: Google Gemini configured');
} else {
  console.log('✗ NOT READY: Check settings');
}

Should output: ✓ READY

If NOT READY, go back and check:
  1. Did you enable the provider toggle?
  2. Did you paste an actual API key?
  3. Did you wait for auto-save or click Save?

================================================================================
API KEY SOURCES
================================================================================

Google Gemini:        https://aistudio.google.com/app/apikey
OpenAI (GPT-4):       https://platform.openai.com/api-keys
Anthropic (Claude):   https://console.anthropic.com/settings/keys
Mistral:              https://console.mistral.ai/api-keys/
Groq:                 https://console.groq.com/keys
DeepSeek:             https://platform.deepseek.com/api_keys

Make sure you:
  1. Copy the full API key
  2. Paste without spaces before/after
  3. Use the correct key (not secret key if they're different)

================================================================================
IF YOU GET THIS ERROR:
"No LLM provider configured. Go to Settings → API Keys"
================================================================================

It means getActiveLLMProvider() couldn't find ANY provider with an API key.

This happens when:
  ✗ No apiKey field filled (empty string)
  ✗ Provider not enabled (toggle is OFF)
  ✗ activeLLM not set (dropdown has no selection)
  ✗ Browser cache issue (do hard refresh)
  ✗ Settings not saved (didn't wait for auto-save)

Quick check in console:
  const s=JSON.parse(localStorage.getItem('core_dna_settings')||'{}');
  Object.entries(s.llms||{}).filter(([k,v])=>v.apiKey?.trim())

Should show at least ONE provider with a key.
If empty array, key was never saved.

================================================================================
CONTACT / DEBUG INFO
================================================================================

If still broken, provide this info:

1. Browser console output of:
   JSON.stringify(JSON.parse(localStorage.getItem('core_dna_settings')), null, 2)

2. Did you see "Settings saved" message? Y/N

3. Does the provider toggle show GREEN (enabled)? Y/N

4. Did you wait 3+ seconds after pasting key? Y/N

5. Have you tried hard refresh (Ctrl+Shift+R)? Y/N

6. Which LLM provider are you using? (Google/OpenAI/etc)

================================================================================
